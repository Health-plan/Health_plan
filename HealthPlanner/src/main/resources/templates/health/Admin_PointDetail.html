<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layout/basic">
<th:block layout:fragment="title">
	<title>포인트 상세조회</title>
</th:block>
<body>
	<th:block layout:fragment="contents">
		<div class="title">
			<h4 class="main_title fw-bold mb-4 d-inline-block">포인트 관리</h4>
			<h5 class="sub_title d-inline-block">상세조회</h5>
		</div>

		<div class="table-responsive clearfix rounded">
			<div class="float-end">
				<button type="button" class="btn btn-secondary"
					data-bs-toggle="modal" data-bs-target="#addPointRecord">포인트
					적립/차감</button>
				<button type="button" class="btn btn-light"
					onclick="location.href='admin_point.do'">뒤로가기</button>
			</div>

			<div class="modal fade" id="addPointRecord" tabindex="-1"
				aria-labelledby="" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered modal-lg">
					<div class="modal-content">
						<form th:action="@{admin_insertPointRecord.do}" method="get"
							th:object="${params}">
							<input type="hidden" th:field="*{mbrId}" value="${mbrId}">
							<input type="hidden" name="mbrNm" th:value="${mbrNm}">
							<div class="modal-header">
								<h5 class="modal-title">포인트 적립/차감</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Close"></button>
							</div>
							<div class="modal-body">
								<div class="container-fluid">
									<div class="row pb-2">
										<div class="col-6">&nbsp;포인트 내용</div>
										<div class="col-3">&nbsp;분류</div>
										<div class="col-3">&nbsp;포인트 값</div>
									</div>
									<div class="row">
										<div class="col-6">
											<select class="form-select" id="modalSelect" th:field="*{pointId}">
												<option th:each=" police : ${police} "
													th:value="${police.pointId}" 
													th:text="${police.pointContents}" />
											</select>
										</div>
										<div class="col-3">
											<input type="text" id="policeCategory" class="form-control"
												th:value="${police[0].pointCategory}" readonly>
										</div>
										<div class="col-3">
											<input type="number" id="policeValue" class="form-control"
												th:value="${police[0].pointValue}" readonly>
										</div>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn" data-bs-dismiss="modal"
									aria-label="Close">취소</button>
								<button type="submit" class="btn btn-secondary">입력</button>
							</div>
						</form>
					</div>
				</div>
			</div>

			<table class="table table-hover text-center text-nowrap w-50">
				<thead>
					<tr class="bg-light">
						<th>아이디</th>
						<th>이름</th>
						<th>현재포인트</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td scope="row" th:text="${mbrId}" />
						<td scope="row" th:text="${mbrNm}" />
						<td scope="row" th:if="${point} >= 0" th:text="${point} + 'p'" />
						<td scope="row" th:unless="${point} >= 0" th:text="0" />
					</tr>
				</tbody>
			</table>

			<table class="table table-hover text-center text-nowrap">
				<thead>
					<tr class="bg-light">
						<th>번호</th>
						<th>날짜</th>
						<th>분류</th>
						<th>포인트</th>
						<th>사용내역</th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${not #lists.isEmpty(list)}" th:each="row, i : ${list}">
						<td scope="row"
							th:text="(${params.currentPageNo} - 1) * 10 + ${i.count}" />
						<td scope="row" th:text="${row.pointDate}" />
						<td scope="row" th:text="${row.pointPoliceDTO.pointCategory}" />
						<td scope="row" th:text="${row.pointPoliceDTO.pointValue} + 'p'" />
						<td scope="row" th:text="${row.pointPoliceDTO.pointContents}" />
					</tr>
					<tr th:unless="${not #lists.isEmpty( list )}">
						<td colspan="7">조회된 결과가 없습니다.</td>
					</tr>
				</tbody>
			</table>

		</div>

		<div class="page_navigation">
			<th:block layout:fragment="paging">
				<nav th:replace="fragments/common :: pagination"></nav>
			</th:block>
		</div>

		<div class="search">
			<th:block layout:fragment="search">
				<!-- <div th:replace="fragments/common :: search_Question"></div> -->
			</th:block>
		</div>

		<th:block layout:fragment="script">
			<script th:inline="javascript">
				var sideMenuIcon = document.getElementById('pointMgt');
				sideMenuIcon.ariaExpanded = "true";
				var sideMenuShow = document.getElementById('point-collapse');
				sideMenuShow.className = "collapse show";

				var mbrId = /*[[${mbrId}]]*/null;
				var mbrNm = /*[[${mbrNm}]]*/null;

				/*<![CDATA[*/
				function movePage(uri, queryString) {
					location.href = uri + queryString + '&mbrId=' + mbrId
							+ '&mbrNm=' + mbrNm;
				}

				var modalSelect = document.getElementById('modalSelect');
				modalSelect.addEventListener('change',function() {
									var policeList = /*[[${police}]]*/null;
									var policeCategory = document
											.getElementById('policeCategory');
									var policeValue = document
											.getElementById('policeValue');

									for (var list = 0; list < policeList.length; list++) {
										if (modalSelect.value == policeList[list].pointId) {
											policeCategory.value = policeList[list].pointCategory;
											policeValue.value = policeList[list].pointValue;
										}
									}
								})

				/*]]*/
			</script>
		</th:block>
	</th:block>

</body>
</html>